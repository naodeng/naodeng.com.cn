<!doctype html><html lang=zh dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>K6 性能测试教程：常用功能（2）- 阈值，测试生命周期和场景 | 软件测试同学</title>
<meta name=keywords content><meta name=description content="这篇博文深入介绍了 K6 性能测试工具的常用功能，主要聚焦在阈值设置、测试生命周期和场景设计方面。阐述了如何利用 K6 在性能测试中设定合理的阈值，以便有效监测系统的性能表现。同时，探讨了测试生命周期的重要性，以及如何在不同阶段进行有针对性的性能测试。此外，博文还详细解释了 K6 中场景的概念，以及如何根据实际需求设计和配置场景，确保测试全面覆盖各种使用情景。通过本文，读者能够更深入地了解 K6 性能测试工具在项目中的实际应用，提高性能测试的效果和准确性。"><meta name=author content="nao.deng"><link rel=canonical href=https://naodeng.com.cn/zh/posts/performance-testing/k6-tutorial-common-functions-2-thresholds-test-lifecycle-and-scenarios/><meta name=google-site-verification content="google5e9a7c9479924ed2"><link crossorigin=anonymous href=/assets/css/stylesheet.b609c58d5c11bb90b1a54e04005d74ad1ddf22165eb79f5533967e57df9c3b50.css integrity="sha256-tgnFjVwRu5CxpU4EAF10rR3fIhZet59VM5Z+V9+cO1A=" rel="preload stylesheet" as=style><link rel=icon href=https://naodeng.com.cn/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://naodeng.com.cn/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://naodeng.com.cn/favicon-32x32.png><link rel=apple-touch-icon href=https://naodeng.com.cn/apple-touch-icon.png><link rel=mask-icon href=https://naodeng.com.cn/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=zh href=https://naodeng.com.cn/zh/posts/performance-testing/k6-tutorial-common-functions-2-thresholds-test-lifecycle-and-scenarios/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta name=baidu-site-verification content="codeva-2siuZUJUWf"><script>var _hmt=_hmt||[];(function(){var e,t=document.createElement("script");t.src="https://hm.baidu.com/hm.js?93a34d905469b810e5bae990720e7139",e=document.getElementsByTagName("script")[0],e.parentNode.insertBefore(t,e)})()</script><script defer data-website-id=b3b285c9-3c35-4398-9252-91bb70560b84 src=https://naodeng-umami.vercel.app/hugo.js></script><script defer src=https://static.cloudflareinsights.com/beacon.min.js data-cf-beacon='{"token": "baa460bb003847e184ad7cbf459449e9"}'></script><meta http-equiv=Content-Type content="text/html;charset=gb2312"><meta name=sogou_site_verification content="iwkYDJrzfK"><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-7249159446737834" crossorigin=anonymous></script><script async src="https://www.googletagmanager.com/gtag/js?id=G-JBX883ZDJJ"></script><script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-JBX883ZDJJ",{anonymize_ip:!1})}</script><meta property="og:title" content="K6 性能测试教程：常用功能（2）- 阈值，测试生命周期和场景"><meta property="og:description" content="这篇博文深入介绍了 K6 性能测试工具的常用功能，主要聚焦在阈值设置、测试生命周期和场景设计方面。阐述了如何利用 K6 在性能测试中设定合理的阈值，以便有效监测系统的性能表现。同时，探讨了测试生命周期的重要性，以及如何在不同阶段进行有针对性的性能测试。此外，博文还详细解释了 K6 中场景的概念，以及如何根据实际需求设计和配置场景，确保测试全面覆盖各种使用情景。通过本文，读者能够更深入地了解 K6 性能测试工具在项目中的实际应用，提高性能测试的效果和准确性。"><meta property="og:type" content="article"><meta property="og:url" content="https://naodeng.com.cn/zh/posts/performance-testing/k6-tutorial-common-functions-2-thresholds-test-lifecycle-and-scenarios/"><meta property="og:image" content="https://naodeng.com.cn/papermod-cover.png"><meta property="article:section" content="posts"><meta property="article:published_time" content="2024-01-18T17:10:00+08:00"><meta property="article:modified_time" content="2024-01-18T17:10:00+08:00"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://naodeng.com.cn/papermod-cover.png"><meta name=twitter:title content="K6 性能测试教程：常用功能（2）- 阈值，测试生命周期和场景"><meta name=twitter:description content="这篇博文深入介绍了 K6 性能测试工具的常用功能，主要聚焦在阈值设置、测试生命周期和场景设计方面。阐述了如何利用 K6 在性能测试中设定合理的阈值，以便有效监测系统的性能表现。同时，探讨了测试生命周期的重要性，以及如何在不同阶段进行有针对性的性能测试。此外，博文还详细解释了 K6 中场景的概念，以及如何根据实际需求设计和配置场景，确保测试全面覆盖各种使用情景。通过本文，读者能够更深入地了解 K6 性能测试工具在项目中的实际应用，提高性能测试的效果和准确性。"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://naodeng.com.cn/zh/posts/"},{"@type":"ListItem","position":2,"name":"K6 性能测试教程：常用功能（2）- 阈值，测试生命周期和场景","item":"https://naodeng.com.cn/zh/posts/performance-testing/k6-tutorial-common-functions-2-thresholds-test-lifecycle-and-scenarios/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"K6 性能测试教程：常用功能（2）- 阈值，测试生命周期和场景","name":"K6 性能测试教程：常用功能（2）- 阈值，测试生命周期和场景","description":"这篇博文深入介绍了 K6 性能测试工具的常用功能，主要聚焦在阈值设置、测试生命周期和场景设计方面。阐述了如何利用 K6 在性能测试中设定合理的阈值，以便有效监测系统的性能表现。同时，探讨了测试生命周期的重要性，以及如何在不同阶段进行有针对性的性能测试。此外，博文还详细解释了 K6 中场景的概念，以及如何根据实际需求设计和配置场景，确保测试全面覆盖各种使用情景。通过本文，读者能够更深入地了解 K6 性能测试工具在项目中的实际应用，提高性能测试的效果和准确性。","keywords":[],"articleBody":"K6 常用功能 上一篇博文介绍了K6 性能测试教程：常用功能（1）- HTTP 请求，指标和检查 这一篇文章主要聚焦在阈值设置、测试生命周期和场景设计方面。阐述了如何利用 K6 在性能测试中设定合理的阈值，以便有效监测系统的性能表现。同时，探讨了测试生命周期的重要性，以及如何在不同阶段进行有针对性的性能测试。\nThresholds 阈值 什么是阈值 阈值一般是我们为测试指标定义的通过/失败标准。对于 K6 来说，如果被测系统的性能不满足阈值条件，测试将以失败状态结束。\n前面提到的检查（check）是用来验证测试结果是否符合预期，check 不通过，测试还会继续，而阈值（threshold）是用来验证测试结果是否符合性能要求。如果不符合，测试将以失败状态结束。\n通常情况下，我们进行性能测试时会使用阈值来编写不同服务或接口的 SLOs(服务级别目标 Service Level Objectives)。\n下面为一些阈值的例子：\n不到 1% 的请求返回错误。 95% 的请求响应时间低于 200 毫秒。 99% 的请求响应时间低于 400 毫秒。 特定端点始终在 300 毫秒内响应。 自定义指标（等待时间趋势）的任何条件（大于 300 毫秒）。 如果后续会写性能自动化测试脚本，那么阈值就是必不可少的。\n给你的测试一个阈值。 自动化执行 设置测试失败警报。 HTTP 错误和响应持续时间的阈值示例 以下示例演示如何使用阈值来设置并评估 HTTP 错误率（http_req_failed 指标）和评估 95% 的请求响应是否在特定持续时间内发生（http_req_duration 指标）：\nimport http from 'k6/http'; export const options = { thresholds: { http_req_failed: ['rate\u003c0.01'], // HTTP 错误率应该低于 1% http_req_duration: ['p(95)\u003c200'], // 95% 的请求响应应该低于 200ms }, }; export default function () { http.get('https://test-api.k6.io/public/crocodiles/1/'); } 上述的示例中，我们设置了两个阈值：\nHTTP 错误率应该低于 1%。（用到了 http_req_failed 指标） 95% 的请求响应应该低于 200ms。（用到了 http_req_duration 指标） 对于上面代码设置的阈值，如果运行的时候，HTTP 错误率低于 1% 和 95% 的请求响应低于 200ms，那么测试就会以成功状态结束，否则任一阈值不满足，测试就将以失败状态结束。\n运行该脚本，可以看到如下结果：\n结果中显示，http_req_failed 阈值通过了，http_req_duration 阈值没有通过，整体测试以失败状态结束。\n如果任何阈值失败，则阈值名称（http_req_failed、http_req_duration）旁边的绿色小复选标记 ✓ 将是 ✗ 并且 k6 将以非零值退出退出代码。\n阈值语法 阈值语法是一个字符串，由以下部分组成：\n指标名称（例如 http_req_duration）。 一个或多个条件，用逗号分隔。 每个条件都由一个运算符和一个值组成。 运算符可以是以下之一：\u003e、\u003e=、\u003c、\u003c=、==、!=、=~、!~。 值可以是数字或百分比。 百分比值必须在 0 到 100 之间。 想要在测试脚本中使用阈值，步骤如下：\n1.在 options 对象中添加 thresholds 属性，如下所示：\nexport const options = { thresholds: { /* ... */ }, }; 2.在 thresholds 对象中定义阈值表达式（至少一个，可以多个），如下所示：\nexport const options = { thresholds: { //短格式 METRIC_NAME1: ['THRESHOLD_EXPRESSION', `...`], //长格式 METRIC_NAME2: [ { threshold: 'THRESHOLD_EXPRESSION', abortOnFail: true, // boolean delayAbortEval: '10s', // string }, ], // full format }, }; 阈值表达式支持短格式和长格式，短格式将所有阈值表达式作为字符串放入数组中。长格式将每个阈值放入一个对象中，并具有在失败时中止的额外属性。 上面示例代码中的 METRIC_NAME1 和 THRESHOLD_EXPRESSION 是占位符。正常情况下必须是指标名称和阈值表达式。 示例代码声明配置指标 metric_name1 和 metric_name2 的两个阈值。通过评估阈值后的’threshold_expression’来确定阈值是通过还是失败，. 阈值表达式语法 阈值表达式的计算结果为 true 或 false 。阈值表达式必须采用以下格式：\n\u003caggregation_method\u003e \u003coperator\u003e \u003cvalue\u003e ：聚合方法，用于计算指标的值。例如，p(95) 表示 95% 百分位数，而 avg 表示平均值。 ：运算符，用于比较指标的值与阈值表达式中的值。例如，\u003e 表示大于，\u003c 表示小于，== 表示等于。 ：阈值表达式中的值。例如，200 表示 200 毫秒，95 表示 95%。 阈值表达式的一些示例如下：\navg \u003c 200 // 平均持续时间必须小于 200 毫秒 count \u003e= 500 // 计数必须大于或等于 500 p(90) \u003c 300 // 90% 的样本必须低于 300 按类型划分的聚合方法 k6 根据类型聚合指标。这些聚合方法构成阈值表达式的一部分。\n以下是按类型划分的聚合方法列表：\n指标类型 聚合方法 ｜Counter count 计数 和 rate 比率 ｜Gauge value 具体的值 ｜Rate rate 比率 ｜Trend avg 平均值、min 最小值、max 最大值、med 和 p(N) 其中 N 指定阈值百分位值，表示为 0.0 到 100 之间的数字。p(99.99) 表示第 99.99 个百分位。这些值以毫秒为单位。｜ 一个复杂的聚合方法示例：\nimport http from 'k6/http'; import { Trend, Rate, Counter, Gauge } from 'k6/metrics'; import { sleep } from 'k6'; export const TrendRTT = new Trend('RTT'); export const RateContentOK = new Rate('Content OK'); export const GaugeContentSize = new Gauge('ContentSize'); export const CounterErrors = new Counter('Errors'); export const options = { thresholds: { // 计数：不允许超过 99 次返回错误的内容。 'Errors': ['count\u003c100'], // 计量：返回的内容必须控制在 4000 字节以下。 'ContentSize': ['value\u003c4000'], // 比率：内容必须在 95 次以上达到“OK”。 'Content OK': ['rate\u003e0.95'], // 趋势：百分位数、平均值、中位数和最小值必须保持在指定的毫秒范围内。 'RTT': ['p(99)\u003c300', 'p(70)\u003c250', 'avg\u003c200', 'med\u003c150', 'min\u003c100'], }, }; export default function () { const res = http.get('https://test-api.k6.io/public/crocodiles/1/'); const contentOK = res.json('name') === 'Bert'; TrendRTT.add(res.timings.duration); RateContentOK.add(contentOK); GaugeContentSize.add(res.body.length); CounterErrors.add(!contentOK); sleep(1); } 注意：不要通过重复相同的对象键来为同一指标指定多个阈值。\n由于阈值被定义为 JavaScript 对象的属性，因此您不能指定多个具有相同属性名称的阈值。如果要为一个指标设置多个阈值，请使用同一键的数组指定它们。\n常用的阈值示例 使用阈值的最快方法是先使用内置指标。以下是一些常用的复制示例\n1.在指定持续时间内完成的请求百分比 import http from 'k6/http'; import { sleep } from 'k6'; export const options = { thresholds: { // 90% 的请求必须在 400 毫秒内完成。 http_req_duration: ['p(90) \u003c 400'], }, }; export default function () { http.get('https://test-api.k6.io/public/crocodiles/1/'); sleep(1); } 2.错误率低于 1% import http from 'k6/http'; import { sleep } from 'k6'; export const options = { thresholds: { // 在整个测试执行过程中，错误率必须低于 1％。 http_req_failed: ['rate\u003c0.01'], }, }; export default function () { http.get('https://test-api.k6.io/public/crocodiles/1/'); sleep(1); } 3.单个指标的多个阈值 我们也可以为一项指标应用多个阈值。该阈值对于不同的请求百分位数有不同的持续时间要求。\nimport http from 'k6/http'; import { sleep } from 'k6'; export const options = { thresholds: { // 90％的请求必须在 400 毫秒内完成，95％在 800 毫秒内完成，99.9％在 2 秒内完成。 http_req_duration: ['p(90) \u003c 400', 'p(95) \u003c 800', 'p(99.9) \u003c 2000'], }, }; export default function () { const res1 = http.get('https://test-api.k6.io/public/crocodiles/1/'); sleep(1); } 4.持续时间组的阈值 我们也可以为每个组设置阈值。此代码具有针对单独请求和批量请求的组。对于每个组，都有不同的阈值。\nimport http from 'k6/http'; import { group, sleep } from 'k6'; export const options = { thresholds: { 'group_duration{group:::individualRequests}': ['avg \u003c 400'], 'group_duration{group:::batchRequests}': ['avg \u003c 200'], }, vus: 1, duration: '10s', }; export default function () { group('individualRequests', function () { http.get('https://test-api.k6.io/public/crocodiles/1/'); http.get('https://test-api.k6.io/public/crocodiles/2/'); http.get('https://test-api.k6.io/public/crocodiles/3/'); }); group('batchRequests', function () { http.batch([ ['GET', `https://test-api.k6.io/public/crocodiles/1/`], ['GET', `https://test-api.k6.io/public/crocodiles/2/`], ['GET', `https://test-api.k6.io/public/crocodiles/3/`], ]); }); sleep(1); } 超过阈值时中止测试 如果在测试过程中，我们想要在阈值不满足时中止测试，那么可以使用 abortOnFail 属性。\n将 abortOnFail 属性设置为 true。当您设置 abortOnFail 时，一旦阈值失败，测试运行就会停止。\n这里也会有一种特殊情况，测试可能会因为这个阈值的设定导致在测试生成重要数据之前中止。为了防止这些情况，我们可以使用 delayAbortEval 延迟 abortOnFail。在此脚本中，abortOnFail 延迟了十秒。十秒后，如果未达到 p(99) \u003c 10 阈值，测试将中止。\nexport const options = { thresholds: { metric_name: [ { threshold: 'p(99) \u003c 10', // string abortOnFail: true, // boolean delayAbortEval: '10s', // string /*...*/ }, ], }, }; 更多阈值的内容，请参考官方文档：https://k6.io/docs/using-k6/thresholds/\nTest lifecycle 测试生命周期 K6 框架中的测试的生命周期，测试脚本始终都以下面的相同顺序进行执行：\ninit 初始化阶段：上下文中的代码准备脚本、加载文件、导入模块并定义测试生命周期函数。必需的。 setup 前置准备设置阶段：设置测试环境并生成数据。可选的。 VU UV 阶段：代码在 default 或场景函数中运行，运行时间和次数与 options 定义的一样长。必需的。 teardown 后置测试退出阶段：对数据进行后处理并关闭测试环境。可选的。 生命周期函数：除了初始化代码之外，每个阶段都在生命周期函数中发生，这是在 k6 运行时按照特定顺序调用的函数。\n下面是一个完整的测试生命周期示例：\n// 1. 配置 init 阶段（必需的） export function setup() { // 2. 配置 setup 阶段（可选的） } export default function (data) { // 3. 配置 VU 阶段（必需的） } export function teardown(data) { // 4. 配置 teardown 阶段（可选的） } 生命周期阶段概述 测试阶段 目的 示例 请求次数 init 初始化阶段 加载本地文件、导入模块、声明生命周期函数 打开 JSON 文件，导入模块 每个 VU 一次* Setup 前置准备配置阶段 设置要处理的数据，在 VU 之间共享数据 调用 API 启动测试环境 一次 VU code VU 代码阶段 运行测试函数，通常是 default 发出 https 请求，验证响应 每次迭代一次，根据测试选项的需要进行多次 Teardown 测试后置退出阶段 设置代码的处理结果，停止测试环境 验证设置是否有一定的结果，发送 webhook 通知测试已完成 一次 ** * 在云脚本中，init 代码可能会被更频繁地调用。** 如果 Setup 函数异常结束（例如抛出错误），则不会调用 teardown() 函数。考虑向 setup() 函数添加逻辑以处理错误并确保正确清理。\ninit 初始化阶段 K6 测试的必要阶段。这个阶段用来在测试之前准备测试环境和初始化测试条件\ninit 上下文中的代码每个 VU 都会运行一次。\n一般在init 阶段可能会做的事情：\n导入模块 从本地文件系统加载文件 为所有 options 配置测试 为 VU、setup 和 teardown 阶段（以及自定义或 handleSummary() 函数）定义生命周期函数。 init 上下文中的代码始终首先执行\nVU 阶段 VU 阶段是测试的核心。在这个阶段，代码在 default 或场景函数中运行，运行时间和次数与 options 定义的一样长。\n关于 UV 阶段的 Q\u0026A：\n1.为什么有 VU 阶段？\nVU 阶段是测试的核心，脚本必须至少包含一个定义 VU 逻辑的场景函数。该函数内部的代码是 VU 代码。 VU 阶段是真正的测试代码，所以 VU 阶段的代码会被多次执行，执行次数由 options 定义的一样长。 2.为什么把 init 阶段和 VU 阶段分开\n将 init 阶段与 VU 阶段分离，可以消除 VU 代码中不相关的计算，从而提高 k6 性能并使测试结果更加可靠。init 代码的一个限制是它无法发出 HTTP 请求。此限制确保 init 阶段在测试中可重现（协议请求的响应是动态且不可预测的） 将 init 阶段与 VU 阶段分离，可以使 VU 阶段的代码更加简洁，更加专注于测试逻辑。 3.UV 阶段的默认函数生命周期的理解\nVU 从头到尾依次执行 default() 函数。一旦 VU 到达函数末尾，它就会循环回到开头并重新执行代码 作为此“重新启动”过程的一部分，k6 会重置 VU。Cookie 被清除，TCP 连接可能被断开（取决于我们的测试配置选项）。 Setup 测试前置准备配置阶段 和 teardown 测试后置退出阶段 Setup 和 teardown 阶段是可选的。这两个阶段都是在 VU 阶段之前和之后运行的。\n与 default 一样，setup 和 teardown 函数必须是导出函数。但与 default 函数不同，k6 每次测试仅调用 setup 和 teardown 一次。\nsetup 在测试开始时调用，在 init 阶段之后但在 VU 阶段之前。 teardown 在测试结束时、VU 阶段（default 函数）之后调用。 与 init 阶段不同，您可以在设置和拆卸阶段调用完整的 k6 API 更多 K6 测试生命周期的内容，请参考官方文档：https://k6.io/docs/using-k6/test-life-cycle/\nScenarios 测试场景 在 K6 的测试脚本中，可以定义多个测试场景，每个场景都可以有自己的配置项，例如 VU 数量、持续时间等。\n测试场景可以详细配置 VU 和迭代计划的方式。通过测试场景配置，我们可以在性能测试中对不同的工作负载或流量模式进行更好的根据业务进行自定义。\n使用测试场景配置的好处：\n更简便、更灵活的测试组织方式。您可以在同一个脚本中定义多个测试场景，每个场景可以独立执行不同的 JavaScript 函数。 模拟更真实的流量情况。每个测试场景都可以使用不同的虚拟用户（VU）和迭代调度模式，由专门设计的执行器提供支持。 并行或顺序工作负载。各个场景相互独立并行运行，尽管可以通过仔细设置每个场景的 startTime 属性使它们看起来像是按顺序运行的。 细致入微的结果分析。可以为每个场景设置不同的环境变量和指标标签。 测试场景配置 我们可以使用代码中的 options 对象中的 scenarios 键值来配置具体场景方案。也可以为场景指定任意名称，只要脚本中的每个场景名称都是唯一的即可。\n场景配置示例：\nexport const options = { scenarios: { example_scenario: { // 使用的执行器名称 executor: 'shared-iterations', // 常规的场景配置 startTime: '10s', gracefulStop: '5s', env: { EXAMPLEVAR: 'testing' }, tags: { example_tag: 'testing' }, // 与执行器相关的特殊配置 vus: 10, iterations: 200, maxDuration: '10s', }, another_scenario: { /*...*/ }, }, }; 测试场景执行器 对于每个 k6 场景，VU（虚拟用户）的工作负载由执行器进行调度。执行器配置测试运行的持续时间、流量是否保持恒定或变化，以及工作负载是由 VU 还是到达率（即开放或关闭模型）建模的。\n我们设置的测试场景对象必须定义 executor 属性，并选择其中一个预定义的执行器名称。您选择的执行器将决定 k6 如何对负载进行建模。可选项包括：\n按迭代次数。\nshared-iterations 在 VU 之间共享迭代。 per-vu-iterations 让每个 VU 运行配置的迭代。 按 VU 数量。\nconstant-VUs 以恒定数量发送 VU。 ramping-vus 根据您配置的阶段增加 VU 数量。 按迭代率。\nconstant-arrival-rate 以恒定速率开始迭代。 ramping-arrival-rate 根据您配置的阶段提高迭代率。 除了这些通用场景选项之外，每个执行程序对象还具有特定于其工作负载的其他选项，可以点击执行者获取更多\n测试场景配置选项 选项名称 类型 描述 默认值 executor(必填) string 唯一的执行者名称 - startTime string 自测试开始以来的时间偏移，此时该场景应开始执行。 “0s” gracefulStop string 在强行停止迭代之前等待迭代完成执行的时间。要了解更多信息，请阅读优雅停止。 “30s” exec string 要执行的导出 JS 函数的名称。 “default” env object 此场景特定的环境变量。 {} tags object 特定于此场景的标签。 {} 测试场景示例 测试场景的 demo 脚本 会结合两种场景并按顺序执行：\nshared_iter_scenario 立即启动。10 个 VU 尝试尽快使用 100 次迭代（某些 VU 可能比其他 VU 使用更多迭代）。 per_vu_scenario 在 10 秒后开始。在这种情况下，十个 VU 每个运行十次迭代。 示例代码如下：\nimport http from 'k6/http'; export const options = { scenarios: { shared_iter_scenario: { executor: 'shared-iterations', vus: 10, iterations: 100, startTime: '0s', }, per_vu_scenario: { executor: 'per-vu-iterations', vus: 10, iterations: 10, startTime: '10s', }, }, }; export default function () { http.get('https://test.k6.io/'); } 运行场景 demo 脚本，可以看到如下结果：\n观看测试结果，你会发现配置了场景的测试结果中，除了常规的测试结果外，k6 输出将包含有关 demo 场景的 详细结果信息 (shared_iter_scenario 场景和 per_vu_scenario 场景的很详细的指标信息)。\n更多关于测试场景的内容，请参考官方文档：https://k6.io/docs/using-k6/scenarios/\n参考文档 K6 文档：https://k6.io/docs/ k6 官方网站：https://k6.io/ K6 性能测试快速启动项目：https://github.com/Automation-Test-Starter/K6-Performance-Test-starter/ K6 性能测试教程：常用功能（1）- HTTP 请求，指标和检查:https://naodeng.com.cn/zh/posts/performance-testing/k6-tutorial-common-functions-1-http-request-metrics-and-checks/ 欢迎关注软件测试同学的公众号“软件测试同学”，原创 QA 技术文章第一时间推送。\n","wordCount":"1082","inLanguage":"zh","datePublished":"2024-01-18T17:10:00+08:00","dateModified":"2024-01-18T17:10:00+08:00","author":{"@type":"Person","name":"nao.deng"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://naodeng.com.cn/zh/posts/performance-testing/k6-tutorial-common-functions-2-thresholds-test-lifecycle-and-scenarios/"},"publisher":{"@type":"Organization","name":"软件测试同学","logo":{"@type":"ImageObject","url":"https://naodeng.com.cn/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://naodeng.com.cn/zh/ accesskey=h title="软件测试同学 (Alt + H)">软件测试同学</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button><ul class=lang-switch><li>|</li><li><a href=https://naodeng.com.cn/ title=🇬🇧English aria-label=🇬🇧English>🇬🇧English</a></li></ul></div></div><ul id=menu><li><a href=https://naodeng.com.cn/zh/archives/ title=归档><span>归档</span></a></li><li><a href=https://naodeng.com.cn/zh/zhcategories title=分类><span>分类</span></a></li><li><a href=https://naodeng.com.cn/zh/search/ title=搜索><span>搜索</span></a></li><li><a href=https://naodeng.com.cn/zh/zhtags title=标签><span>标签</span></a></li><li><a href=https://naodeng.com.cn/zh/zhseries title=系列><span>系列</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://naodeng.com.cn/zh/>主页</a>&nbsp;»&nbsp;<a href=https://naodeng.com.cn/zh/posts/>Posts</a></div><h1 class="post-title entry-hint-parent">K6 性能测试教程：常用功能（2）- 阈值，测试生命周期和场景</h1><div class=post-meta><span title='2024-01-18 17:10:00 +0800 +0800'>一月 18, 2024</span>&nbsp;·&nbsp;6 分钟&nbsp;·&nbsp;1082 字&nbsp;·&nbsp;nao.deng&nbsp;|&nbsp;<a href=https://github.com/naodeng/naodeng.com.cn/tree/main/content/posts/Performance-Testing/K6-tutorial-common-functions-2-thresholds-test-lifecycle-and-scenarios.zh.md rel="noopener noreferrer" target=_blank>Suggest Changes</a></div></header><div class=toc><details><summary accesskey=c title="(Alt + C)"><span class=details>目录</span></summary><div class=inner><ul><li><a href=#k6-%e5%b8%b8%e7%94%a8%e5%8a%9f%e8%83%bd aria-label="K6 常用功能">K6 常用功能</a><ul><li><a href=#thresholds-%e9%98%88%e5%80%bc aria-label="Thresholds 阈值">Thresholds 阈值</a><ul><li><a href=#%e4%bb%80%e4%b9%88%e6%98%af%e9%98%88%e5%80%bc aria-label=什么是阈值>什么是阈值</a></li><li><a href=#http-%e9%94%99%e8%af%af%e5%92%8c%e5%93%8d%e5%ba%94%e6%8c%81%e7%bb%ad%e6%97%b6%e9%97%b4%e7%9a%84%e9%98%88%e5%80%bc%e7%a4%ba%e4%be%8b aria-label="HTTP 错误和响应持续时间的阈值示例">HTTP 错误和响应持续时间的阈值示例</a></li><li><a href=#%e9%98%88%e5%80%bc%e8%af%ad%e6%b3%95 aria-label=阈值语法>阈值语法</a><ul><li><a href=#%e9%98%88%e5%80%bc%e8%a1%a8%e8%be%be%e5%bc%8f%e8%af%ad%e6%b3%95 aria-label=阈值表达式语法>阈值表达式语法</a></li><li><a href=#%e6%8c%89%e7%b1%bb%e5%9e%8b%e5%88%92%e5%88%86%e7%9a%84%e8%81%9a%e5%90%88%e6%96%b9%e6%b3%95 aria-label=按类型划分的聚合方法>按类型划分的聚合方法</a></li></ul></li><li><a href=#%e5%b8%b8%e7%94%a8%e7%9a%84%e9%98%88%e5%80%bc%e7%a4%ba%e4%be%8b aria-label=常用的阈值示例>常用的阈值示例</a><ul><li><a href=#1%e5%9c%a8%e6%8c%87%e5%ae%9a%e6%8c%81%e7%bb%ad%e6%97%b6%e9%97%b4%e5%86%85%e5%ae%8c%e6%88%90%e7%9a%84%e8%af%b7%e6%b1%82%e7%99%be%e5%88%86%e6%af%94 aria-label=1.在指定持续时间内完成的请求百分比>1.在指定持续时间内完成的请求百分比</a></li><li><a href=#2%e9%94%99%e8%af%af%e7%8e%87%e4%bd%8e%e4%ba%8e-1 aria-label="2.错误率低于 1%">2.错误率低于 1%</a></li><li><a href=#3%e5%8d%95%e4%b8%aa%e6%8c%87%e6%a0%87%e7%9a%84%e5%a4%9a%e4%b8%aa%e9%98%88%e5%80%bc aria-label=3.单个指标的多个阈值>3.单个指标的多个阈值</a></li><li><a href=#4%e6%8c%81%e7%bb%ad%e6%97%b6%e9%97%b4%e7%bb%84%e7%9a%84%e9%98%88%e5%80%bc aria-label=4.持续时间组的阈值>4.持续时间组的阈值</a></li></ul></li><li><a href=#%e8%b6%85%e8%bf%87%e9%98%88%e5%80%bc%e6%97%b6%e4%b8%ad%e6%ad%a2%e6%b5%8b%e8%af%95 aria-label=超过阈值时中止测试>超过阈值时中止测试</a></li></ul></li><li><a href=#test-lifecycle-%e6%b5%8b%e8%af%95%e7%94%9f%e5%91%bd%e5%91%a8%e6%9c%9f aria-label="Test lifecycle 测试生命周期">Test lifecycle 测试生命周期</a><ul><li><a href=#%e7%94%9f%e5%91%bd%e5%91%a8%e6%9c%9f%e9%98%b6%e6%ae%b5%e6%a6%82%e8%bf%b0 aria-label=生命周期阶段概述>生命周期阶段概述</a></li><li><a href=#init-%e5%88%9d%e5%a7%8b%e5%8c%96%e9%98%b6%e6%ae%b5 aria-label="init 初始化阶段">init 初始化阶段</a></li><li><a href=#vu-%e9%98%b6%e6%ae%b5 aria-label="VU 阶段">VU 阶段</a></li><li><a href=#setup-%e6%b5%8b%e8%af%95%e5%89%8d%e7%bd%ae%e5%87%86%e5%a4%87%e9%85%8d%e7%bd%ae%e9%98%b6%e6%ae%b5-%e5%92%8c-teardown-%e6%b5%8b%e8%af%95%e5%90%8e%e7%bd%ae%e9%80%80%e5%87%ba%e9%98%b6%e6%ae%b5 aria-label="Setup 测试前置准备配置阶段 和 teardown 测试后置退出阶段">Setup 测试前置准备配置阶段 和 teardown 测试后置退出阶段</a></li></ul></li><li><a href=#scenarios-%e6%b5%8b%e8%af%95%e5%9c%ba%e6%99%af aria-label="Scenarios 测试场景">Scenarios 测试场景</a><ul><li><a href=#%e6%b5%8b%e8%af%95%e5%9c%ba%e6%99%af%e9%85%8d%e7%bd%ae aria-label=测试场景配置>测试场景配置</a></li><li><a href=#%e6%b5%8b%e8%af%95%e5%9c%ba%e6%99%af%e6%89%a7%e8%a1%8c%e5%99%a8 aria-label=测试场景执行器>测试场景执行器</a></li><li><a href=#%e6%b5%8b%e8%af%95%e5%9c%ba%e6%99%af%e9%85%8d%e7%bd%ae%e9%80%89%e9%a1%b9 aria-label=测试场景配置选项>测试场景配置选项</a></li><li><a href=#%e6%b5%8b%e8%af%95%e5%9c%ba%e6%99%af%e7%a4%ba%e4%be%8b aria-label=测试场景示例>测试场景示例</a></li></ul></li></ul></li><li><a href=#%e5%8f%82%e8%80%83%e6%96%87%e6%a1%a3 aria-label=参考文档>参考文档</a></li></ul></div></details></div><div class=post-content><h2 id=k6-常用功能>K6 常用功能<a hidden class=anchor aria-hidden=true href=#k6-常用功能>#</a></h2><p>上一篇博文介绍了<a href=https://naodeng.com.cn/zh/posts/performance-testing/k6-tutorial-common-functions-1-http-request-metrics-and-checks/>K6 性能测试教程：常用功能（1）- HTTP 请求，指标和检查</a> 这一篇文章主要聚焦在阈值设置、测试生命周期和场景设计方面。阐述了如何利用 K6 在性能测试中设定合理的阈值，以便有效监测系统的性能表现。同时，探讨了测试生命周期的重要性，以及如何在不同阶段进行有针对性的性能测试。</p><h3 id=thresholds-阈值>Thresholds 阈值<a hidden class=anchor aria-hidden=true href=#thresholds-阈值>#</a></h3><h4 id=什么是阈值>什么是阈值<a hidden class=anchor aria-hidden=true href=#什么是阈值>#</a></h4><p>阈值一般是我们为测试指标定义的通过/失败标准。对于 K6 来说，如果被测系统的性能不满足阈值条件，<strong>测试将以失败状态结束</strong>。</p><blockquote><p>前面提到的检查（check）是用来验证测试结果是否符合预期，check 不通过，测试还会继续，而阈值（threshold）是用来验证测试结果是否符合性能要求。如果不符合，测试将以失败状态结束。</p></blockquote><p>通常情况下，我们进行性能测试时会使用阈值来编写不同服务或接口的 SLOs(服务级别目标 Service Level Objectives)。</p><p>下面为一些阈值的例子：</p><ul><li>不到 1% 的请求返回错误。</li><li>95% 的请求响应时间低于 200 毫秒。</li><li>99% 的请求响应时间低于 400 毫秒。</li><li>特定端点始终在 300 毫秒内响应。</li><li>自定义指标（等待时间趋势）的任何条件（大于 300 毫秒）。</li></ul><p>如果后续会写性能自动化测试脚本，那么阈值就是必不可少的。</p><ul><li>给你的测试一个阈值。</li><li>自动化执行</li><li>设置测试失败警报。</li></ul><h4 id=http-错误和响应持续时间的阈值示例>HTTP 错误和响应持续时间的阈值示例<a hidden class=anchor aria-hidden=true href=#http-错误和响应持续时间的阈值示例>#</a></h4><p>以下示例演示如何使用阈值来设置并评估 HTTP 错误率（http_req_failed 指标）和评估 95% 的请求响应是否在特定持续时间内发生（http_req_duration 指标）：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kr>import</span> <span class=nx>http</span> <span class=nx>from</span> <span class=s1>&#39;k6/http&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>export</span> <span class=kr>const</span> <span class=nx>options</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>thresholds</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>http_req_failed</span><span class=o>:</span> <span class=p>[</span><span class=s1>&#39;rate&lt;0.01&#39;</span><span class=p>],</span> <span class=c1>// HTTP 错误率应该低于 1%
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>http_req_duration</span><span class=o>:</span> <span class=p>[</span><span class=s1>&#39;p(95)&lt;200&#39;</span><span class=p>],</span> <span class=c1>// 95% 的请求响应应该低于 200ms
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=p>},</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>export</span> <span class=k>default</span> <span class=kd>function</span> <span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>http</span><span class=p>.</span><span class=nx>get</span><span class=p>(</span><span class=s1>&#39;https://test-api.k6.io/public/crocodiles/1/&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>上述的示例中，我们设置了两个阈值：</p><ul><li>HTTP 错误率应该低于 1%。（用到了 http_req_failed 指标）</li><li>95% 的请求响应应该低于 200ms。（用到了 http_req_duration 指标）</li></ul><p>对于上面代码设置的阈值，如果运行的时候，HTTP 错误率低于 1% 和 95% 的请求响应低于 200ms，那么测试就会以成功状态结束，否则任一阈值不满足，测试就将以失败状态结束。</p><p>运行该脚本，可以看到如下结果：</p><p><img loading=lazy src=https://cdn.jsdelivr.net/gh/naodeng/blogimg@master/uPic/EiPBZ9.png alt=" "></p><p>结果中显示，http_req_failed 阈值通过了，http_req_duration 阈值没有通过，整体测试以失败状态结束。</p><blockquote><p>如果任何阈值失败，则阈值名称（http_req_failed、http_req_duration）旁边的绿色小复选标记 ✓ 将是 ✗ 并且 k6 将以非零值退出退出代码。</p></blockquote><h4 id=阈值语法>阈值语法<a hidden class=anchor aria-hidden=true href=#阈值语法>#</a></h4><p>阈值语法是一个字符串，由以下部分组成：</p><ul><li>指标名称（例如 http_req_duration）。</li><li>一个或多个条件，用逗号分隔。</li><li>每个条件都由一个运算符和一个值组成。</li><li>运算符可以是以下之一：>、>=、&lt;、&lt;=、==、!=、=~、!~。</li><li>值可以是数字或百分比。</li><li>百分比值必须在 0 到 100 之间。</li></ul><p>想要在测试脚本中使用阈值，步骤如下：</p><p>1.在 options 对象中添加 thresholds 属性，如下所示：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kr>export</span> <span class=kr>const</span> <span class=nx>options</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>thresholds</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=cm>/* ... */</span>
</span></span><span class=line><span class=cl>  <span class=p>},</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span></code></pre></div><p>2.在 thresholds 对象中定义阈值表达式（至少一个，可以多个），如下所示：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kr>export</span> <span class=kr>const</span> <span class=nx>options</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>thresholds</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>//短格式
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>METRIC_NAME1</span><span class=o>:</span> <span class=p>[</span><span class=s1>&#39;THRESHOLD_EXPRESSION&#39;</span><span class=p>,</span> <span class=sb>`...`</span><span class=p>],</span>
</span></span><span class=line><span class=cl>    <span class=c1>//长格式
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>METRIC_NAME2</span><span class=o>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>      <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>threshold</span><span class=o>:</span> <span class=s1>&#39;THRESHOLD_EXPRESSION&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nx>abortOnFail</span><span class=o>:</span> <span class=kc>true</span><span class=p>,</span> <span class=c1>// boolean
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=nx>delayAbortEval</span><span class=o>:</span> <span class=s1>&#39;10s&#39;</span><span class=p>,</span> <span class=c1>// string
</span></span></span><span class=line><span class=cl><span class=c1></span>      <span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=p>],</span> <span class=c1>// full format
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=p>},</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span></code></pre></div><ul><li>阈值表达式支持短格式和长格式，短格式将所有阈值表达式作为字符串放入数组中。长格式将每个阈值放入一个对象中，并具有在失败时中止的额外属性。</li><li>上面示例代码中的 METRIC_NAME1 和 THRESHOLD_EXPRESSION 是占位符。正常情况下必须是指标名称和阈值表达式。</li><li>示例代码声明配置指标 metric_name1 和 metric_name2 的两个阈值。通过评估阈值后的&rsquo;threshold_expression&rsquo;来确定阈值是通过还是失败，.</li></ul><h5 id=阈值表达式语法>阈值表达式语法<a hidden class=anchor aria-hidden=true href=#阈值表达式语法>#</a></h5><p>阈值表达式的计算结果为 <code>true</code> 或 <code>false</code> 。阈值表达式必须采用以下格式：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=o>&lt;</span><span class=nx>aggregation_method</span><span class=o>&gt;</span> <span class=o>&lt;</span><span class=nx>operator</span><span class=o>&gt;</span> <span class=o>&lt;</span><span class=nx>value</span><span class=o>&gt;</span>
</span></span></code></pre></div><ul><li><code>&lt;aggregation_method></code>：聚合方法，用于计算指标的值。例如，p(95) 表示 95% 百分位数，而 avg 表示平均值。</li><li><code>&lt;operator></code>：运算符，用于比较指标的值与阈值表达式中的值。例如，> 表示大于，&lt; 表示小于，== 表示等于。</li><li><code>&lt;value></code>：阈值表达式中的值。例如，200 表示 200 毫秒，95 表示 95%。</li></ul><p>阈值表达式的一些示例如下：</p><ul><li>avg &lt; 200 // 平均持续时间必须小于 200 毫秒</li><li>count >= 500 // 计数必须大于或等于 500</li><li>p(90) &lt; 300 // 90% 的样本必须低于 300</li></ul><h5 id=按类型划分的聚合方法>按类型划分的聚合方法<a hidden class=anchor aria-hidden=true href=#按类型划分的聚合方法>#</a></h5><p>k6 根据类型聚合指标。这些聚合方法构成阈值表达式的一部分。</p><p>以下是按类型划分的聚合方法列表：</p><table><thead><tr><th>指标类型</th><th>聚合方法</th></tr></thead><tbody><tr><td>｜Counter</td><td>count 计数 和 rate 比率</td></tr><tr><td>｜Gauge</td><td>value 具体的值</td></tr><tr><td>｜Rate</td><td>rate 比率</td></tr><tr><td>｜Trend</td><td>avg 平均值、min 最小值、max 最大值、med 和 p(N) 其中 N 指定阈值百分位值，表示为 0.0 到 100 之间的数字。p(99.99) 表示第 99.99 个百分位。这些值以毫秒为单位。｜</td></tr></tbody></table><p>一个复杂的聚合方法示例：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kr>import</span> <span class=nx>http</span> <span class=nx>from</span> <span class=s1>&#39;k6/http&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=p>{</span> <span class=nx>Trend</span><span class=p>,</span> <span class=nx>Rate</span><span class=p>,</span> <span class=nx>Counter</span><span class=p>,</span> <span class=nx>Gauge</span> <span class=p>}</span> <span class=nx>from</span> <span class=s1>&#39;k6/metrics&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=p>{</span> <span class=nx>sleep</span> <span class=p>}</span> <span class=nx>from</span> <span class=s1>&#39;k6&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>export</span> <span class=kr>const</span> <span class=nx>TrendRTT</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>Trend</span><span class=p>(</span><span class=s1>&#39;RTT&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=kr>export</span> <span class=kr>const</span> <span class=nx>RateContentOK</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>Rate</span><span class=p>(</span><span class=s1>&#39;Content OK&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=kr>export</span> <span class=kr>const</span> <span class=nx>GaugeContentSize</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>Gauge</span><span class=p>(</span><span class=s1>&#39;ContentSize&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=kr>export</span> <span class=kr>const</span> <span class=nx>CounterErrors</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>Counter</span><span class=p>(</span><span class=s1>&#39;Errors&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=kr>export</span> <span class=kr>const</span> <span class=nx>options</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>thresholds</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// 计数：不允许超过 99 次返回错误的内容。
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=s1>&#39;Errors&#39;</span><span class=o>:</span> <span class=p>[</span><span class=s1>&#39;count&lt;100&#39;</span><span class=p>],</span>
</span></span><span class=line><span class=cl>    <span class=c1>// 计量：返回的内容必须控制在 4000 字节以下。
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=s1>&#39;ContentSize&#39;</span><span class=o>:</span> <span class=p>[</span><span class=s1>&#39;value&lt;4000&#39;</span><span class=p>],</span>
</span></span><span class=line><span class=cl>    <span class=c1>// 比率：内容必须在 95 次以上达到“OK”。
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=s1>&#39;Content OK&#39;</span><span class=o>:</span> <span class=p>[</span><span class=s1>&#39;rate&gt;0.95&#39;</span><span class=p>],</span>
</span></span><span class=line><span class=cl>    <span class=c1>// 趋势：百分位数、平均值、中位数和最小值必须保持在指定的毫秒范围内。
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=s1>&#39;RTT&#39;</span><span class=o>:</span> <span class=p>[</span><span class=s1>&#39;p(99)&lt;300&#39;</span><span class=p>,</span> <span class=s1>&#39;p(70)&lt;250&#39;</span><span class=p>,</span> <span class=s1>&#39;avg&lt;200&#39;</span><span class=p>,</span> <span class=s1>&#39;med&lt;150&#39;</span><span class=p>,</span> <span class=s1>&#39;min&lt;100&#39;</span><span class=p>],</span>
</span></span><span class=line><span class=cl>  <span class=p>},</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>export</span> <span class=k>default</span> <span class=kd>function</span> <span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=nx>res</span> <span class=o>=</span> <span class=nx>http</span><span class=p>.</span><span class=nx>get</span><span class=p>(</span><span class=s1>&#39;https://test-api.k6.io/public/crocodiles/1/&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=nx>contentOK</span> <span class=o>=</span> <span class=nx>res</span><span class=p>.</span><span class=nx>json</span><span class=p>(</span><span class=s1>&#39;name&#39;</span><span class=p>)</span> <span class=o>===</span> <span class=s1>&#39;Bert&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nx>TrendRTT</span><span class=p>.</span><span class=nx>add</span><span class=p>(</span><span class=nx>res</span><span class=p>.</span><span class=nx>timings</span><span class=p>.</span><span class=nx>duration</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=nx>RateContentOK</span><span class=p>.</span><span class=nx>add</span><span class=p>(</span><span class=nx>contentOK</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=nx>GaugeContentSize</span><span class=p>.</span><span class=nx>add</span><span class=p>(</span><span class=nx>res</span><span class=p>.</span><span class=nx>body</span><span class=p>.</span><span class=nx>length</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=nx>CounterErrors</span><span class=p>.</span><span class=nx>add</span><span class=p>(</span><span class=o>!</span><span class=nx>contentOK</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nx>sleep</span><span class=p>(</span><span class=mi>1</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>注意：不要通过重复相同的对象键来为同一指标指定多个阈值。</p><blockquote><p>由于阈值被定义为 JavaScript 对象的属性，因此您不能指定多个具有相同属性名称的阈值。如果要为一个指标设置多个阈值，请使用同一键的数组指定它们。</p></blockquote><h4 id=常用的阈值示例>常用的阈值示例<a hidden class=anchor aria-hidden=true href=#常用的阈值示例>#</a></h4><p>使用阈值的最快方法是先使用内置指标。以下是一些常用的复制示例</p><h5 id=1在指定持续时间内完成的请求百分比>1.在指定持续时间内完成的请求百分比<a hidden class=anchor aria-hidden=true href=#1在指定持续时间内完成的请求百分比>#</a></h5><div class=highlight><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kr>import</span> <span class=nx>http</span> <span class=nx>from</span> <span class=s1>&#39;k6/http&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=p>{</span> <span class=nx>sleep</span> <span class=p>}</span> <span class=nx>from</span> <span class=s1>&#39;k6&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>export</span> <span class=kr>const</span> <span class=nx>options</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>thresholds</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// 90% 的请求必须在 400 毫秒内完成。
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>http_req_duration</span><span class=o>:</span> <span class=p>[</span><span class=s1>&#39;p(90) &lt; 400&#39;</span><span class=p>],</span>
</span></span><span class=line><span class=cl>  <span class=p>},</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>export</span> <span class=k>default</span> <span class=kd>function</span> <span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>http</span><span class=p>.</span><span class=nx>get</span><span class=p>(</span><span class=s1>&#39;https://test-api.k6.io/public/crocodiles/1/&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=nx>sleep</span><span class=p>(</span><span class=mi>1</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><h5 id=2错误率低于-1>2.错误率低于 1%<a hidden class=anchor aria-hidden=true href=#2错误率低于-1>#</a></h5><div class=highlight><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kr>import</span> <span class=nx>http</span> <span class=nx>from</span> <span class=s1>&#39;k6/http&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=p>{</span> <span class=nx>sleep</span> <span class=p>}</span> <span class=nx>from</span> <span class=s1>&#39;k6&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>export</span> <span class=kr>const</span> <span class=nx>options</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>thresholds</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// 在整个测试执行过程中，错误率必须低于 1％。
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>http_req_failed</span><span class=o>:</span> <span class=p>[</span><span class=s1>&#39;rate&lt;0.01&#39;</span><span class=p>],</span>
</span></span><span class=line><span class=cl>  <span class=p>},</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>export</span> <span class=k>default</span> <span class=kd>function</span> <span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>http</span><span class=p>.</span><span class=nx>get</span><span class=p>(</span><span class=s1>&#39;https://test-api.k6.io/public/crocodiles/1/&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=nx>sleep</span><span class=p>(</span><span class=mi>1</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><h5 id=3单个指标的多个阈值>3.单个指标的多个阈值<a hidden class=anchor aria-hidden=true href=#3单个指标的多个阈值>#</a></h5><p>我们也可以为一项指标应用多个阈值。该阈值对于不同的请求百分位数有不同的持续时间要求。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kr>import</span> <span class=nx>http</span> <span class=nx>from</span> <span class=s1>&#39;k6/http&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=p>{</span> <span class=nx>sleep</span> <span class=p>}</span> <span class=nx>from</span> <span class=s1>&#39;k6&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>export</span> <span class=kr>const</span> <span class=nx>options</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>thresholds</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// 90％的请求必须在 400 毫秒内完成，95％在 800 毫秒内完成，99.9％在 2 秒内完成。
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>http_req_duration</span><span class=o>:</span> <span class=p>[</span><span class=s1>&#39;p(90) &lt; 400&#39;</span><span class=p>,</span> <span class=s1>&#39;p(95) &lt; 800&#39;</span><span class=p>,</span> <span class=s1>&#39;p(99.9) &lt; 2000&#39;</span><span class=p>],</span>
</span></span><span class=line><span class=cl>  <span class=p>},</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>export</span> <span class=k>default</span> <span class=kd>function</span> <span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=nx>res1</span> <span class=o>=</span> <span class=nx>http</span><span class=p>.</span><span class=nx>get</span><span class=p>(</span><span class=s1>&#39;https://test-api.k6.io/public/crocodiles/1/&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=nx>sleep</span><span class=p>(</span><span class=mi>1</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><h5 id=4持续时间组的阈值>4.持续时间组的阈值<a hidden class=anchor aria-hidden=true href=#4持续时间组的阈值>#</a></h5><p>我们也可以为每个组设置阈值。此代码具有针对单独请求和批量请求的组。对于每个组，都有不同的阈值。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kr>import</span> <span class=nx>http</span> <span class=nx>from</span> <span class=s1>&#39;k6/http&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=p>{</span> <span class=nx>group</span><span class=p>,</span> <span class=nx>sleep</span> <span class=p>}</span> <span class=nx>from</span> <span class=s1>&#39;k6&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>export</span> <span class=kr>const</span> <span class=nx>options</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>thresholds</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;group_duration{group:::individualRequests}&#39;</span><span class=o>:</span> <span class=p>[</span><span class=s1>&#39;avg &lt; 400&#39;</span><span class=p>],</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;group_duration{group:::batchRequests}&#39;</span><span class=o>:</span> <span class=p>[</span><span class=s1>&#39;avg &lt; 200&#39;</span><span class=p>],</span>
</span></span><span class=line><span class=cl>  <span class=p>},</span>
</span></span><span class=line><span class=cl>  <span class=nx>vus</span><span class=o>:</span> <span class=mi>1</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nx>duration</span><span class=o>:</span> <span class=s1>&#39;10s&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>export</span> <span class=k>default</span> <span class=kd>function</span> <span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>group</span><span class=p>(</span><span class=s1>&#39;individualRequests&#39;</span><span class=p>,</span> <span class=kd>function</span> <span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>http</span><span class=p>.</span><span class=nx>get</span><span class=p>(</span><span class=s1>&#39;https://test-api.k6.io/public/crocodiles/1/&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nx>http</span><span class=p>.</span><span class=nx>get</span><span class=p>(</span><span class=s1>&#39;https://test-api.k6.io/public/crocodiles/2/&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nx>http</span><span class=p>.</span><span class=nx>get</span><span class=p>(</span><span class=s1>&#39;https://test-api.k6.io/public/crocodiles/3/&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>});</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nx>group</span><span class=p>(</span><span class=s1>&#39;batchRequests&#39;</span><span class=p>,</span> <span class=kd>function</span> <span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>http</span><span class=p>.</span><span class=nx>batch</span><span class=p>([</span>
</span></span><span class=line><span class=cl>      <span class=p>[</span><span class=s1>&#39;GET&#39;</span><span class=p>,</span> <span class=sb>`https://test-api.k6.io/public/crocodiles/1/`</span><span class=p>],</span>
</span></span><span class=line><span class=cl>      <span class=p>[</span><span class=s1>&#39;GET&#39;</span><span class=p>,</span> <span class=sb>`https://test-api.k6.io/public/crocodiles/2/`</span><span class=p>],</span>
</span></span><span class=line><span class=cl>      <span class=p>[</span><span class=s1>&#39;GET&#39;</span><span class=p>,</span> <span class=sb>`https://test-api.k6.io/public/crocodiles/3/`</span><span class=p>],</span>
</span></span><span class=line><span class=cl>    <span class=p>]);</span>
</span></span><span class=line><span class=cl>  <span class=p>});</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nx>sleep</span><span class=p>(</span><span class=mi>1</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><h4 id=超过阈值时中止测试>超过阈值时中止测试<a hidden class=anchor aria-hidden=true href=#超过阈值时中止测试>#</a></h4><p>如果在测试过程中，我们想要在阈值不满足时中止测试，那么可以使用 <code>abortOnFail</code> 属性。</p><p>将 abortOnFail 属性设置为 true。当您设置 abortOnFail 时，一旦阈值失败，测试运行就会停止。</p><blockquote><p>这里也会有一种特殊情况，测试可能会因为这个阈值的设定导致在测试生成重要数据之前中止。为了防止这些情况，我们可以使用 delayAbortEval 延迟 abortOnFail。在此脚本中，abortOnFail 延迟了十秒。十秒后，如果未达到 p(99) &lt; 10 阈值，测试将中止。</p></blockquote><div class=highlight><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kr>export</span> <span class=kr>const</span> <span class=nx>options</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>thresholds</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>metric_name</span><span class=o>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>      <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>threshold</span><span class=o>:</span> <span class=s1>&#39;p(99) &lt; 10&#39;</span><span class=p>,</span> <span class=c1>// string
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=nx>abortOnFail</span><span class=o>:</span> <span class=kc>true</span><span class=p>,</span> <span class=c1>// boolean
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=nx>delayAbortEval</span><span class=o>:</span> <span class=s1>&#39;10s&#39;</span><span class=p>,</span> <span class=c1>// string
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=cm>/*...*/</span>
</span></span><span class=line><span class=cl>      <span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=p>],</span>
</span></span><span class=line><span class=cl>  <span class=p>},</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span></code></pre></div><p>更多阈值的内容，请参考官方文档：<a href=https://k6.io/docs/using-k6/thresholds/>https://k6.io/docs/using-k6/thresholds/</a></p><h3 id=test-lifecycle-测试生命周期>Test lifecycle 测试生命周期<a hidden class=anchor aria-hidden=true href=#test-lifecycle-测试生命周期>#</a></h3><p>K6 框架中的测试的生命周期，测试脚本始终都以下面的相同顺序进行执行：</p><ul><li><code>init</code> 初始化阶段：上下文中的代码准备脚本、加载文件、导入模块并定义测试<code>生命周期函数</code>。必需的。</li><li><code>setup</code> 前置准备设置阶段：设置测试环境并生成数据。可选的。</li><li><code>VU</code> UV 阶段：代码在 default 或场景函数中运行，运行时间和次数与 options 定义的一样长。必需的。</li><li><code>teardown</code> 后置测试退出阶段：对数据进行后处理并关闭测试环境。可选的。</li></ul><blockquote><p>生命周期函数：除了初始化代码之外，每个阶段都在生命周期函数中发生，这是在 k6 运行时按照特定顺序调用的函数。</p></blockquote><p>下面是一个完整的测试生命周期示例：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=c1>// 1. 配置 init 阶段（必需的）
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=kr>export</span> <span class=kd>function</span> <span class=nx>setup</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=c1>// 2. 配置 setup 阶段（可选的）
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>export</span> <span class=k>default</span> <span class=kd>function</span> <span class=p>(</span><span class=nx>data</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=c1>// 3. 配置 VU 阶段（必需的）
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>export</span> <span class=kd>function</span> <span class=nx>teardown</span><span class=p>(</span><span class=nx>data</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=c1>// 4. 配置 teardown  阶段（可选的）
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>}</span>
</span></span></code></pre></div><h4 id=生命周期阶段概述>生命周期阶段概述<a hidden class=anchor aria-hidden=true href=#生命周期阶段概述>#</a></h4><table><thead><tr><th>测试阶段</th><th>目的</th><th>示例</th><th>请求次数</th></tr></thead><tbody><tr><td>init 初始化阶段</td><td>加载本地文件、导入模块、声明生命周期函数</td><td>打开 JSON 文件，导入模块</td><td>每个 VU 一次*</td></tr><tr><td>Setup 前置准备配置阶段</td><td>设置要处理的数据，在 VU 之间共享数据</td><td>调用 API 启动测试环境</td><td>一次</td></tr><tr><td>VU code VU 代码阶段</td><td>运行测试函数，通常是 default</td><td>发出 https 请求，验证响应</td><td>每次迭代一次，根据测试选项的需要进行多次</td></tr><tr><td>Teardown 测试后置退出阶段</td><td>设置代码的处理结果，停止测试环境</td><td>验证设置是否有一定的结果，发送 webhook 通知测试已完成</td><td>一次 **</td></tr></tbody></table><blockquote><p><code>*</code> 在云脚本中，init 代码可能会被更频繁地调用。<code>**</code> 如果 Setup 函数异常结束（例如抛出错误），则不会调用 teardown() 函数。考虑向 setup() 函数添加逻辑以处理错误并确保正确清理。</p></blockquote><h4 id=init-初始化阶段>init 初始化阶段<a hidden class=anchor aria-hidden=true href=#init-初始化阶段>#</a></h4><p>K6 测试的必要阶段。这个阶段用来在测试之前准备测试环境和初始化测试条件</p><blockquote><p>init 上下文中的代码每个 VU 都会运行一次。</p></blockquote><p>一般在<code>init</code> 阶段可能会做的事情：</p><ul><li>导入模块</li><li>从本地文件系统加载文件</li><li>为所有 options 配置测试</li><li>为 VU、setup 和 teardown 阶段（以及自定义或 handleSummary() 函数）定义生命周期函数。</li></ul><blockquote><p>init 上下文中的代码始终首先执行</p></blockquote><h4 id=vu-阶段>VU 阶段<a hidden class=anchor aria-hidden=true href=#vu-阶段>#</a></h4><p>VU 阶段是测试的核心。在这个阶段，代码在 default 或场景函数中运行，运行时间和次数与 options 定义的一样长。</p><p>关于 UV 阶段的 Q&amp;A：</p><ul><li><p>1.为什么有 VU 阶段？</p><ul><li>VU 阶段是测试的核心，脚本必须至少包含一个定义 VU 逻辑的场景函数。该函数内部的代码是 VU 代码。</li><li>VU 阶段是真正的测试代码，所以 VU 阶段的代码会被多次执行，执行次数由 options 定义的一样长。</li></ul></li><li><p>2.为什么把 init 阶段和 VU 阶段分开</p><ul><li>将 init 阶段与 VU 阶段分离，可以消除 VU 代码中不相关的计算，从而提高 k6 性能并使测试结果更加可靠。init 代码的一个限制是它无法发出 HTTP 请求。此限制确保 init 阶段在测试中可重现（协议请求的响应是动态且不可预测的）</li><li>将 init 阶段与 VU 阶段分离，可以使 VU 阶段的代码更加简洁，更加专注于测试逻辑。</li></ul></li><li><p>3.UV 阶段的默认函数生命周期的理解</p><ul><li>VU 从头到尾依次执行 default() 函数。一旦 VU 到达函数末尾，它就会循环回到开头并重新执行代码</li><li>作为此“重新启动”过程的一部分，k6 会重置 VU。Cookie 被清除，TCP 连接可能被断开（取决于我们的测试配置选项）。</li></ul></li></ul><h4 id=setup-测试前置准备配置阶段-和-teardown-测试后置退出阶段>Setup 测试前置准备配置阶段 和 teardown 测试后置退出阶段<a hidden class=anchor aria-hidden=true href=#setup-测试前置准备配置阶段-和-teardown-测试后置退出阶段>#</a></h4><p>Setup 和 teardown 阶段是可选的。这两个阶段都是在 VU 阶段之前和之后运行的。</p><p>与 default 一样，setup 和 teardown 函数必须是导出函数。但与 default 函数不同，k6 每次测试仅调用 setup 和 teardown 一次。</p><ul><li>setup 在测试开始时调用，在 init 阶段之后但在 VU 阶段之前。</li><li>teardown 在测试结束时、VU 阶段（default 函数）之后调用。</li><li>与 init 阶段不同，您可以在设置和拆卸阶段调用完整的 k6 API</li></ul><p>更多 K6 测试生命周期的内容，请参考官方文档：<a href=https://k6.io/docs/using-k6/test-life-cycle/>https://k6.io/docs/using-k6/test-life-cycle/</a></p><h3 id=scenarios-测试场景>Scenarios 测试场景<a hidden class=anchor aria-hidden=true href=#scenarios-测试场景>#</a></h3><p>在 K6 的测试脚本中，可以定义多个测试场景，每个场景都可以有自己的配置项，例如 VU 数量、持续时间等。</p><p>测试场景可以详细配置 VU 和迭代计划的方式。通过测试场景配置，我们可以在性能测试中对不同的工作负载或流量模式进行更好的根据业务进行自定义。</p><p>使用测试场景配置的好处：</p><ul><li>更简便、更灵活的测试组织方式。您可以在同一个脚本中定义多个测试场景，每个场景可以独立执行不同的 JavaScript 函数。</li><li>模拟更真实的流量情况。每个测试场景都可以使用不同的虚拟用户（VU）和迭代调度模式，由专门设计的执行器提供支持。</li><li>并行或顺序工作负载。各个场景相互独立并行运行，尽管可以通过仔细设置每个场景的 startTime 属性使它们看起来像是按顺序运行的。</li><li>细致入微的结果分析。可以为每个场景设置不同的环境变量和指标标签。</li></ul><h4 id=测试场景配置>测试场景配置<a hidden class=anchor aria-hidden=true href=#测试场景配置>#</a></h4><p>我们可以使用代码中的 options 对象中的 scenarios 键值来配置具体场景方案。也可以为场景指定任意名称，只要脚本中的每个场景名称都是唯一的即可。</p><p>场景配置示例：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kr>export</span> <span class=kr>const</span> <span class=nx>options</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>scenarios</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>example_scenario</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=c1>// 使用的执行器名称
</span></span></span><span class=line><span class=cl><span class=c1></span>      <span class=nx>executor</span><span class=o>:</span> <span class=s1>&#39;shared-iterations&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>      <span class=c1>// 常规的场景配置
</span></span></span><span class=line><span class=cl><span class=c1></span>      <span class=nx>startTime</span><span class=o>:</span> <span class=s1>&#39;10s&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>gracefulStop</span><span class=o>:</span> <span class=s1>&#39;5s&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>env</span><span class=o>:</span> <span class=p>{</span> <span class=nx>EXAMPLEVAR</span><span class=o>:</span> <span class=s1>&#39;testing&#39;</span> <span class=p>},</span>
</span></span><span class=line><span class=cl>      <span class=nx>tags</span><span class=o>:</span> <span class=p>{</span> <span class=nx>example_tag</span><span class=o>:</span> <span class=s1>&#39;testing&#39;</span> <span class=p>},</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>      <span class=c1>// 与执行器相关的特殊配置
</span></span></span><span class=line><span class=cl><span class=c1></span>      <span class=nx>vus</span><span class=o>:</span> <span class=mi>10</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>iterations</span><span class=o>:</span> <span class=mi>200</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>maxDuration</span><span class=o>:</span> <span class=s1>&#39;10s&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=nx>another_scenario</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=cm>/*...*/</span>
</span></span><span class=line><span class=cl>    <span class=p>},</span>
</span></span><span class=line><span class=cl>  <span class=p>},</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span></code></pre></div><h4 id=测试场景执行器>测试场景执行器<a hidden class=anchor aria-hidden=true href=#测试场景执行器>#</a></h4><p>对于每个 k6 场景，VU（虚拟用户）的工作负载由执行器进行调度。执行器配置测试运行的持续时间、流量是否保持恒定或变化，以及工作负载是由 VU 还是到达率（即开放或关闭模型）建模的。</p><p>我们设置的测试场景对象必须定义 executor 属性，并选择其中一个预定义的执行器名称。您选择的执行器将决定 k6 如何对负载进行建模。可选项包括：</p><ul><li><p>按迭代次数。</p><ul><li>shared-iterations 在 VU 之间共享迭代。</li><li>per-vu-iterations 让每个 VU 运行配置的迭代。</li></ul></li><li><p>按 VU 数量。</p><ul><li>constant-VUs 以恒定数量发送 VU。</li><li>ramping-vus 根据您配置的阶段增加 VU 数量。</li></ul></li><li><p>按迭代率。</p><ul><li>constant-arrival-rate 以恒定速率开始迭代。</li><li>ramping-arrival-rate 根据您配置的阶段提高迭代率。</li></ul></li></ul><p>除了这些通用场景选项之外，每个执行程序对象还具有特定于其工作负载的其他选项，可以点击<a href=https://grafana.com/docs/k6/latest/using-k6/scenarios/executors>执行者</a>获取更多</p><h4 id=测试场景配置选项>测试场景配置选项<a hidden class=anchor aria-hidden=true href=#测试场景配置选项>#</a></h4><table><thead><tr><th>选项名称</th><th>类型</th><th>描述</th><th>默认值</th></tr></thead><tbody><tr><td>executor(必填)</td><td>string</td><td>唯一的执行者名称</td><td>-</td></tr><tr><td>startTime</td><td>string</td><td>自测试开始以来的时间偏移，此时该场景应开始执行。</td><td>&ldquo;0s&rdquo;</td></tr><tr><td>gracefulStop</td><td>string</td><td>在强行停止迭代之前等待迭代完成执行的时间。要了解更多信息，请阅读优雅停止。</td><td>&ldquo;30s&rdquo;</td></tr><tr><td>exec</td><td>string</td><td>要执行的导出 JS 函数的名称。</td><td>&ldquo;default&rdquo;</td></tr><tr><td>env</td><td>object</td><td>此场景特定的环境变量。</td><td>{}</td></tr><tr><td>tags</td><td>object</td><td>特定于此场景的标签。</td><td>{}</td></tr></tbody></table><h4 id=测试场景示例>测试场景示例<a hidden class=anchor aria-hidden=true href=#测试场景示例>#</a></h4><p>测试场景的 demo 脚本 会结合两种场景并按顺序执行：</p><ul><li>shared_iter_scenario 立即启动。10 个 VU 尝试尽快使用 100 次迭代（某些 VU 可能比其他 VU 使用更多迭代）。</li><li>per_vu_scenario 在 10 秒后开始。在这种情况下，十个 VU 每个运行十次迭代。</li></ul><p>示例代码如下：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kr>import</span> <span class=nx>http</span> <span class=nx>from</span> <span class=s1>&#39;k6/http&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>export</span> <span class=kr>const</span> <span class=nx>options</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>scenarios</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>shared_iter_scenario</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>executor</span><span class=o>:</span> <span class=s1>&#39;shared-iterations&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>vus</span><span class=o>:</span> <span class=mi>10</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>iterations</span><span class=o>:</span> <span class=mi>100</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>startTime</span><span class=o>:</span> <span class=s1>&#39;0s&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=nx>per_vu_scenario</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>executor</span><span class=o>:</span> <span class=s1>&#39;per-vu-iterations&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>vus</span><span class=o>:</span> <span class=mi>10</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>iterations</span><span class=o>:</span> <span class=mi>10</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>startTime</span><span class=o>:</span> <span class=s1>&#39;10s&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=p>},</span>
</span></span><span class=line><span class=cl>  <span class=p>},</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>export</span> <span class=k>default</span> <span class=kd>function</span> <span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>http</span><span class=p>.</span><span class=nx>get</span><span class=p>(</span><span class=s1>&#39;https://test.k6.io/&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>运行场景 demo 脚本，可以看到如下结果：</p><p><img loading=lazy src=https://cdn.jsdelivr.net/gh/naodeng/blogimg@master/uPic/zLDexk.png alt=" "></p><p>观看测试结果，你会发现配置了场景的测试结果中，除了常规的测试结果外，k6 输出将包含有关 demo 场景的 详细结果信息 (shared_iter_scenario 场景和 per_vu_scenario 场景的很详细的指标信息)。</p><p>更多关于测试场景的内容，请参考官方文档：<a href=https://k6.io/docs/using-k6/scenarios/>https://k6.io/docs/using-k6/scenarios/</a></p><h2 id=参考文档>参考文档<a hidden class=anchor aria-hidden=true href=#参考文档>#</a></h2><ul><li><a href=https://k6.io/docs/>K6 文档：https://k6.io/docs/</a></li><li><a href=https://k6.io/>k6 官方网站：https://k6.io/</a></li><li><a href=https://github.com/Automation-Test-Starter/K6-Performance-Test-starter>K6 性能测试快速启动项目：https://github.com/Automation-Test-Starter/K6-Performance-Test-starter/</a></li><li><a href=https://naodeng.com.cn/zh/posts/performance-testing/k6-tutorial-common-functions-1-http-request-metrics-and-checks/>K6 性能测试教程：常用功能（1）- HTTP 请求，指标和检查:https://naodeng.com.cn/zh/posts/performance-testing/k6-tutorial-common-functions-1-http-request-metrics-and-checks/</a></li></ul><hr><p>欢迎关注软件测试同学的公众号“<strong>软件测试同学</strong>”，原创 QA 技术文章第一时间推送。</p><center><img src="https://cdn.jsdelivr.net/gh/naodeng/blogimg@master/uPic/2023112015'QR Code for 公众号.jpg" style=width:100px></center></div><footer class=post-footer><ul class=post-tags></ul><nav class=paginav><a class=prev href=https://naodeng.com.cn/zh/posts/ui-automation-testing/ui-testing-best-practice-generic-best-practices-2-ui-tests-debugging-best-practices-and-reaching-ui-state/><span class=title>« 上一页</span><br><span>UI 测试最佳实践的通用最佳实践（二）：UI 测试调试最佳实践和在测试中达到 UI 状态而无需使用 UI</span>
</a><a class=next href=https://naodeng.com.cn/zh/posts/ui-automation-testing/ui-testing-best-practice-generic-best-practices-1-await-dont-sleep-and-name-test-files-wisely/><span class=title>下一页 »</span><br><span>UI 测试最佳实践的通用最佳实践（一）：等待，不要休眠和明智地为测试文件命名</span></a></nav><ul class=share-buttons><li><a target=_blank rel="noopener noreferrer" aria-label="share K6 性能测试教程：常用功能（2）- 阈值，测试生命周期和场景 on x" href="https://x.com/intent/tweet/?text=K6%20%e6%80%a7%e8%83%bd%e6%b5%8b%e8%af%95%e6%95%99%e7%a8%8b%ef%bc%9a%e5%b8%b8%e7%94%a8%e5%8a%9f%e8%83%bd%ef%bc%882%ef%bc%89-%20%e9%98%88%e5%80%bc%ef%bc%8c%e6%b5%8b%e8%af%95%e7%94%9f%e5%91%bd%e5%91%a8%e6%9c%9f%e5%92%8c%e5%9c%ba%e6%99%af&amp;url=https%3a%2f%2fnaodeng.com.cn%2fzh%2fposts%2fperformance-testing%2fk6-tutorial-common-functions-2-thresholds-test-lifecycle-and-scenarios%2f&amp;hashtags="><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M512 62.554V449.446C512 483.97 483.97 512 449.446 512H62.554C28.03 512 0 483.97.0 449.446V62.554C0 28.03 28.029.0 62.554.0H449.446C483.971.0 512 28.03 512 62.554zM269.951 190.75 182.567 75.216H56L207.216 272.95 63.9 436.783h61.366L235.9 310.383l96.667 126.4H456L298.367 228.367l134-153.151H371.033zM127.633 110h36.468l219.38 290.065H349.5z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share K6 性能测试教程：常用功能（2）- 阈值，测试生命周期和场景 on linkedin" href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3a%2f%2fnaodeng.com.cn%2fzh%2fposts%2fperformance-testing%2fk6-tutorial-common-functions-2-thresholds-test-lifecycle-and-scenarios%2f&amp;title=K6%20%e6%80%a7%e8%83%bd%e6%b5%8b%e8%af%95%e6%95%99%e7%a8%8b%ef%bc%9a%e5%b8%b8%e7%94%a8%e5%8a%9f%e8%83%bd%ef%bc%882%ef%bc%89-%20%e9%98%88%e5%80%bc%ef%bc%8c%e6%b5%8b%e8%af%95%e7%94%9f%e5%91%bd%e5%91%a8%e6%9c%9f%e5%92%8c%e5%9c%ba%e6%99%af&amp;summary=K6%20%e6%80%a7%e8%83%bd%e6%b5%8b%e8%af%95%e6%95%99%e7%a8%8b%ef%bc%9a%e5%b8%b8%e7%94%a8%e5%8a%9f%e8%83%bd%ef%bc%882%ef%bc%89-%20%e9%98%88%e5%80%bc%ef%bc%8c%e6%b5%8b%e8%af%95%e7%94%9f%e5%91%bd%e5%91%a8%e6%9c%9f%e5%92%8c%e5%9c%ba%e6%99%af&amp;source=https%3a%2f%2fnaodeng.com.cn%2fzh%2fposts%2fperformance-testing%2fk6-tutorial-common-functions-2-thresholds-test-lifecycle-and-scenarios%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM160.461 423.278V197.561h-75.04v225.717h75.04zm270.539.0V293.839c0-69.333-37.018-101.586-86.381-101.586-39.804.0-57.634 21.891-67.617 37.266v-31.958h-75.021c.995 21.181.0 225.717.0 225.717h75.02V297.222c0-6.748.486-13.492 2.474-18.315 5.414-13.475 17.767-27.434 38.494-27.434 27.135.0 38.007 20.707 38.007 51.037v120.768H431zM123.448 88.722C97.774 88.722 81 105.601 81 127.724c0 21.658 16.264 39.002 41.455 39.002h.484c26.165.0 42.452-17.344 42.452-39.002-.485-22.092-16.241-38.954-41.943-39.002z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share K6 性能测试教程：常用功能（2）- 阈值，测试生命周期和场景 on reddit" href="https://reddit.com/submit?url=https%3a%2f%2fnaodeng.com.cn%2fzh%2fposts%2fperformance-testing%2fk6-tutorial-common-functions-2-thresholds-test-lifecycle-and-scenarios%2f&title=K6%20%e6%80%a7%e8%83%bd%e6%b5%8b%e8%af%95%e6%95%99%e7%a8%8b%ef%bc%9a%e5%b8%b8%e7%94%a8%e5%8a%9f%e8%83%bd%ef%bc%882%ef%bc%89-%20%e9%98%88%e5%80%bc%ef%bc%8c%e6%b5%8b%e8%af%95%e7%94%9f%e5%91%bd%e5%91%a8%e6%9c%9f%e5%92%8c%e5%9c%ba%e6%99%af"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM446 265.638c0-22.964-18.616-41.58-41.58-41.58-11.211.0-21.361 4.457-28.841 11.666-28.424-20.508-67.586-33.757-111.204-35.278l18.941-89.121 61.884 13.157c.756 15.734 13.642 28.29 29.56 28.29 16.407.0 29.706-13.299 29.706-29.701.0-16.403-13.299-29.702-29.706-29.702-11.666.0-21.657 6.792-26.515 16.578l-69.105-14.69c-1.922-.418-3.939-.042-5.585 1.036-1.658 1.073-2.811 2.761-3.224 4.686l-21.152 99.438c-44.258 1.228-84.046 14.494-112.837 35.232-7.468-7.164-17.589-11.591-28.757-11.591-22.965.0-41.585 18.616-41.585 41.58.0 16.896 10.095 31.41 24.568 37.918-.639 4.135-.99 8.328-.99 12.576.0 63.977 74.469 115.836 166.33 115.836s166.334-51.859 166.334-115.836c0-4.218-.347-8.387-.977-12.493 14.564-6.47 24.735-21.034 24.735-38.001zM326.526 373.831c-20.27 20.241-59.115 21.816-70.534 21.816-11.428.0-50.277-1.575-70.522-21.82-3.007-3.008-3.007-7.882.0-10.889 3.003-2.999 7.882-3.003 10.885.0 12.777 12.781 40.11 17.317 59.637 17.317 19.522.0 46.86-4.536 59.657-17.321 3.016-2.999 7.886-2.995 10.885.008 3.008 3.011 3.003 7.882-.008 10.889zm-5.23-48.781c-16.373.0-29.701-13.324-29.701-29.698.0-16.381 13.328-29.714 29.701-29.714 16.378.0 29.706 13.333 29.706 29.714.0 16.374-13.328 29.698-29.706 29.698zM160.91 295.348c0-16.381 13.328-29.71 29.714-29.71 16.369.0 29.689 13.329 29.689 29.71.0 16.373-13.32 29.693-29.689 29.693-16.386.0-29.714-13.32-29.714-29.693z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share K6 性能测试教程：常用功能（2）- 阈值，测试生命周期和场景 on facebook" href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2fnaodeng.com.cn%2fzh%2fposts%2fperformance-testing%2fk6-tutorial-common-functions-2-thresholds-test-lifecycle-and-scenarios%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H342.978V319.085h66.6l12.672-82.621h-79.272v-53.617c0-22.603 11.073-44.636 46.58-44.636H425.6v-70.34s-32.71-5.582-63.982-5.582c-65.288.0-107.96 39.569-107.96 111.204v62.971h-72.573v82.621h72.573V512h-191.104c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share K6 性能测试教程：常用功能（2）- 阈值，测试生命周期和场景 on whatsapp" href="https://api.whatsapp.com/send?text=K6%20%e6%80%a7%e8%83%bd%e6%b5%8b%e8%af%95%e6%95%99%e7%a8%8b%ef%bc%9a%e5%b8%b8%e7%94%a8%e5%8a%9f%e8%83%bd%ef%bc%882%ef%bc%89-%20%e9%98%88%e5%80%bc%ef%bc%8c%e6%b5%8b%e8%af%95%e7%94%9f%e5%91%bd%e5%91%a8%e6%9c%9f%e5%92%8c%e5%9c%ba%e6%99%af%20-%20https%3a%2f%2fnaodeng.com.cn%2fzh%2fposts%2fperformance-testing%2fk6-tutorial-common-functions-2-thresholds-test-lifecycle-and-scenarios%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zm-58.673 127.703c-33.842-33.881-78.847-52.548-126.798-52.568-98.799.0-179.21 80.405-179.249 179.234-.013 31.593 8.241 62.428 23.927 89.612l-25.429 92.884 95.021-24.925c26.181 14.28 55.659 21.807 85.658 21.816h.074c98.789.0 179.206-80.413 179.247-179.243.018-47.895-18.61-92.93-52.451-126.81zM263.976 403.485h-.06c-26.734-.01-52.954-7.193-75.828-20.767l-5.441-3.229-56.386 14.792 15.05-54.977-3.542-5.637c-14.913-23.72-22.791-51.136-22.779-79.287.033-82.142 66.867-148.971 149.046-148.971 39.793.014 77.199 15.531 105.329 43.692 28.128 28.16 43.609 65.592 43.594 105.4-.034 82.149-66.866 148.983-148.983 148.984zm81.721-111.581c-4.479-2.242-26.499-13.075-30.604-14.571-4.105-1.495-7.091-2.241-10.077 2.241-2.986 4.483-11.569 14.572-14.182 17.562-2.612 2.988-5.225 3.364-9.703 1.12-4.479-2.241-18.91-6.97-36.017-22.23C231.8 264.15 222.81 249.484 220.198 245s-.279-6.908 1.963-9.14c2.016-2.007 4.48-5.232 6.719-7.847 2.24-2.615 2.986-4.484 4.479-7.472 1.493-2.99.747-5.604-.374-7.846-1.119-2.241-10.077-24.288-13.809-33.256-3.635-8.733-7.327-7.55-10.077-7.688-2.609-.13-5.598-.158-8.583-.158-2.986.0-7.839 1.121-11.944 5.604-4.105 4.484-15.675 15.32-15.675 37.364.0 22.046 16.048 43.342 18.287 46.332 2.24 2.99 31.582 48.227 76.511 67.627 10.685 4.615 19.028 7.371 25.533 9.434 10.728 3.41 20.492 2.929 28.209 1.775 8.605-1.285 26.499-10.833 30.231-21.295 3.732-10.464 3.732-19.431 2.612-21.298-1.119-1.869-4.105-2.99-8.583-5.232z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share K6 性能测试教程：常用功能（2）- 阈值，测试生命周期和场景 on telegram" href="https://telegram.me/share/url?text=K6%20%e6%80%a7%e8%83%bd%e6%b5%8b%e8%af%95%e6%95%99%e7%a8%8b%ef%bc%9a%e5%b8%b8%e7%94%a8%e5%8a%9f%e8%83%bd%ef%bc%882%ef%bc%89-%20%e9%98%88%e5%80%bc%ef%bc%8c%e6%b5%8b%e8%af%95%e7%94%9f%e5%91%bd%e5%91%a8%e6%9c%9f%e5%92%8c%e5%9c%ba%e6%99%af&amp;url=https%3a%2f%2fnaodeng.com.cn%2fzh%2fposts%2fperformance-testing%2fk6-tutorial-common-functions-2-thresholds-test-lifecycle-and-scenarios%2f"><svg viewBox="2 2 28 28" height="30" width="30" fill="currentcolor"><path d="M26.49 29.86H5.5a3.37 3.37.0 01-2.47-1 3.35 3.35.0 01-1-2.47V5.48A3.36 3.36.0 013 3 3.37 3.37.0 015.5 2h21A3.38 3.38.0 0129 3a3.36 3.36.0 011 2.46V26.37a3.35 3.35.0 01-1 2.47 3.38 3.38.0 01-2.51 1.02zm-5.38-6.71a.79.79.0 00.85-.66L24.73 9.24a.55.55.0 00-.18-.46.62.62.0 00-.41-.17q-.08.0-16.53 6.11a.59.59.0 00-.41.59.57.57.0 00.43.52l4 1.24 1.61 4.83a.62.62.0 00.63.43.56.56.0 00.4-.17L16.54 20l4.09 3A.9.9.0 0021.11 23.15zM13.8 20.71l-1.21-4q8.72-5.55 8.78-5.55c.15.0.23.0.23.16a.18.18.0 010 .06s-2.51 2.3-7.52 6.8z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share K6 性能测试教程：常用功能（2）- 阈值，测试生命周期和场景 on ycombinator" href="https://news.ycombinator.com/submitlink?t=K6%20%e6%80%a7%e8%83%bd%e6%b5%8b%e8%af%95%e6%95%99%e7%a8%8b%ef%bc%9a%e5%b8%b8%e7%94%a8%e5%8a%9f%e8%83%bd%ef%bc%882%ef%bc%89-%20%e9%98%88%e5%80%bc%ef%bc%8c%e6%b5%8b%e8%af%95%e7%94%9f%e5%91%bd%e5%91%a8%e6%9c%9f%e5%92%8c%e5%9c%ba%e6%99%af&u=https%3a%2f%2fnaodeng.com.cn%2fzh%2fposts%2fperformance-testing%2fk6-tutorial-common-functions-2-thresholds-test-lifecycle-and-scenarios%2f"><svg width="30" height="30" viewBox="0 0 512 512" fill="currentcolor" xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape"><path d="M449.446.0C483.971.0 512 28.03 512 62.554V449.446C512 483.97 483.97 512 449.446 512H62.554C28.03 512 0 483.97.0 449.446V62.554C0 28.03 28.029.0 62.554.0H449.446zM183.8767 87.9921h-62.034L230.6673 292.4508V424.0079h50.6655V292.4508L390.1575 87.9921H328.1233L256 238.2489z"/></svg></a></li></ul></footer><script src=https://giscus.app/client.js data-repo=naodeng/naodeng.tech data-repo-id=R_kgDOHntNtg data-category="Show and tell" data-category-id=DIC_kwDOHntNts4Cavst data-mapping=pathname data-strict=0 data-reactions-enabled=1 data-emit-metadata=0 data-input-position=bottom data-theme=light data-lang=en crossorigin=anonymous async></script></article></main><footer class=footer><span>&copy; 2024 <a href=https://naodeng.com.cn/zh/>软件测试同学</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="复制";function s(){t.innerHTML="已复制！",setTimeout(()=>{t.innerHTML="复制"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>